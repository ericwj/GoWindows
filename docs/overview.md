# Overview

A little overview of how the testing infrastructure works.

## Architecture

The following components make up the testing solution:

1. The go program `api.exe` which creates *actual* test results.
1. The C# program `epi.exe` which creates *expected* test results.
1. The `GoSetup` PowerShell module which has CmdLets to create
  and destroy a test environment, using virtual disks, SMB shares
  and directories with peculiar structure, file names and lots of links.
1. The `GoTest` PowerShell module, to execute tests but also to generate (lots of) tests.

## Files Used

The following (types of) files are used or produced:
* **Test definition file** The tests are defined using .csv files.
  The `GoBuild` PowerShell module CmdLet `Build-GoTests` and
  `Build-GoClassTests` amongst others build these files
  fully automated and contains more CmdLets
  to customize, extend or replace this functionality.
* These are converted to a JSON **test input** file by the
  `Test-Go` CmdLet defined in the `GoTest` PowerShell module.
* `api.exe` and `epi.exe` produce the same format JSON
  **test result file** given the *test input* file.
  `Test-Go` is able to skip invoking `epi.exe` and use a file
  already on disk (but the input .csv must then exactly match
  with that file, line-by-line).
* `Test-Go` merges the **test input file**,
  **actual** *test result file* and
  **expected** *test result file* to JSON and HTML **result files**.

The results are written as JSON and HTML.
Failures are also filtered and written as JSON and HTML.

## Modes of operation

Go programs are standalone executables. .NET programs can be
published to bring their own version of .NET with them, as
*Self-contained* (a directory) or even as a single file.

* To change the test suite to run against go, `epi.exe` and `api.exe`
  are both required to build JSON files containing *test input* and
  *expected results*, since these files must match line-by-line.

* To run a given test suite against go on say a build server,
  the following is required:
    1. `GoSetup` and its dependencies to setup the test environment
    1. `GoTest` to run `Test-Go`
    1. the .csv *test definition file*,
    1. a matching JSON *expected results* file.

  The other files will then be generated by `Test-Go`.

* For maximum flexibility, `epi.exe` can be published on a developer
  machine and copied to the build server such that the input files
  are never out of sync.
