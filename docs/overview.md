# Overview

A little overview of how the testing infrastructure works.

## Architecture

The following components make up the testing solution:

1. The go program `api.exe` which creates *actual* test results.
1. The C# program `epi.exe` which creates *expected* test results.
1. The `GoSetup` PowerShell module which has CmdLets to create
  and destroy a test environment, using virtual disks, SMB shares
  and directories with peculiar structure, file names and lots of links.
1. The `GoTest` PowerShell module, to execute tests but also to generate (lots of) tests.

## Files Used

The following (types of) files are used or produced:

* **Test definition file** (`name.csv`)  
  The tests are defined using .csv files.
  The `GoTest` PowerShell module CmdLet `Build-GoTests` and
  `Build-GoClassTests` amongst others build these files
  fully automated and the module contains more CmdLets
  to customize, extend or replace this functionality.
* **Test input files** (`name.json`)  
  The test definition files are converted to a JSON file by the
  `Test-Go` CmdLet defined in the `GoTest` PowerShell module.
* **Test output files** (`name.expected.json`, `name.actual.json`)  
  `api.exe` and `epi.exe` take JSON as input and produce
  JSON given the *test input* file.
  `Test-Go` is able to skip invoking `epi.exe` and use a file
  already on disk (but the input .csv must then exactly match
  with that file, line-by-line).
* **Test results files** (`name.results.*`, `name.failures.*`)  
  `Test-Go` merges the **test input file**,
  **actual** *test output file* and
  **expected** *test output file* to JSON and HTML
  *result files*.

All results are written to JSON and HTML files.
Failures are filtered and then written again to distinct JSON and HTML files.

> Producing HTML files can also be done afterwards using the `Join-Go` CmdLet,
> but the function of `Join-Go` is also to establish success and failure for 
> each test and hence would be required during continuous integration builds.


## Modes of operation

Go programs are standalone executables. .NET programs can be
published to bring their own version of .NET with them, as
*Self-contained* (a directory) or even as a single file.

* To change the test suite to run against go, `epi.exe` and `api.exe`
  are both required to build JSON files containing *test input* and
  *expected results*, since these files must match line-by-line.

* To run a given test suite against go on say a build server,
  the following is required:
    1. `GoSetup` and its dependencies to setup the test environment
    1. `GoTest` to run `Test-Go`
    1. the .csv *test definition file*,
    1. a matching JSON *expected results* file.

  The other files will then be generated by `Test-Go`.

## Sample directory

After completing a test run, the files will be on disk, repeated for each *test definition file*:

```PowerShell
PS> dir


    Directory: C:\go

Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a---           7/23/2020  6:25 AM         217812 file.actual.json
-a---           7/23/2020  6:13 AM         301867 file.csv
-a---           7/23/2020  6:25 AM         235024 file.expected.json
-a---           7/23/2020  6:25 AM        1489855 file.failures.html
-a---           7/23/2020  6:25 AM        2926803 file.failures.json
-a---           7/23/2020  6:25 AM         530541 file.json
-a---           7/23/2020  6:25 AM        1718750 file.results.html
-a---           7/23/2020  6:25 AM        3390959 file.results.json
```
